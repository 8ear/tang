#!/bin/bash

depends() {
    echo crypt systemd network
    return 0
}

cmdline() {
    echo "rd.neednet=1"
}

install() {
    if ! dracut_module_included "systemd"; then
        derror "tang-luksd needs systemd in the initramfs"
        return 1
    fi

    cmdline > "${initdir}/etc/cmdline.d/99tang-luksd.conf"

    inst_multiple @libexecdir@/tang-luksd \
        "$systemdsystemunitdir/tang-luksd.service" \
        "$systemdsystemunitdir/tang-luksd.path"

    ln_r  "$systemdsystemunitdir/tang-luksd.path" \
        "$systemdsystemunitdir/sysinit.target.wants/tang-luksd.path"

    dracut_need_initqueue
}

